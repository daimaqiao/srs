<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">

  <script src="js/hls.js/0.13.2/hls.min.js"></script>
  <script src="js/jquery/3.4.1/jquery.min.js"></script>

  <title>play</title>

  <style>
  .mainContainer {
        display: block;
        width: 1024px;
        margin-left: auto;
        margin-right: auto;
  }

  .centeredVideo {
        display: block;
        height: 576px;
        margin-left: auto;
        margin-right: auto;
        margin-bottom: auto;
  }
  </style>
</head>

<!-- play -->
<body>
    <p>
    <div id="mainContainer" class="mainContainer">
        <video id='video' class="centeredVideo" controls poster="/poster/live.jpg">
    </video>
    </div>
    </p>

	<script>

    function getSrc() {
        var channel = 'live';
        var room = 'play';
        var query = window.location.search.substring(1);
        var args = query.split('&');
        for (var i = 0; i < args.length; i++) {
            var pair = args[i].split('=');
            if (pair[0] === 'channel') {
                channel = pair[1];
            } else if(pair[0] === 'room') {
                room = pair[1];
			}
        }// for
        var src = '/video/'+channel+'/'+room+'.m3u8';
        document.title = channel+'-'+room;
        console.log('title:', document.title);
        console.log('url:', window.location.href);
        console.log('src:', src);
        return src; 
    }

    var video = document.getElementById('video');
    if (video.canPlayType('application/vnd.apple.mpegurl')) {
      console.log("play type: application/vnd.apple.mpegurl.");
      video.src = getSrc();
    }
    else if(Hls.isSupported()) {
      console.log("hls(js) is supported.");
      var hls = new Hls();
      hls.loadSource(getSrc());
      hls.attachMedia(video);
    }
    else {
	// FIXME
    }

	</script>

</body>
</html>
